{
  "variables": {
    "ssh_user":      "{{env `DEFAULT_USER`}}",
    "test_image":    "{{env `TEST_IMAGE`}}",
    "test_name":     "{{env `TEST_NAME`}}",
    "matlab_volume": "{{env `MATLAB_VOLUME`}}",
    "inspec_profile":""
  },
  "builders": [
    {
      "type":              "openstack",
      "communicator":      "ssh",
      "ssh_username":      "{{user `ssh_user`}}",
      "source_image_name": "{{user `test_image`}}",
      "image_name":        "{{user `test_name`}}",
      "flavor":            "m3.small",
      "security_groups":  ["default","SSH"]
    }
  ],
  "provisioners": [
    {
      "type": "inspec",
      "inspec_env_vars": ["CHEF_LICENSE=accept"],
      "profile": "{{user `inspec_profile`}}",
      "user": "{{user `ssh_user`}}"
    },
    {
      "type": "shell-local",
      "inline": [
                 "echo",
                 "echo '============================================================='",
                 "echo",
                 "echo 'SUCCESS: TESTS PASSED'",
                 "echo",
                 "echo 'FORCING PACKER TO EXIT WITH AN ERROR TO PREVENT IMAGE UPLOAD'",
                 "echo",
                 "echo '(Ignore packer output beyond this message)'",
                 "echo '============================================================='",
                 "echo",
                 "exit 1"
                 ]
    }
  ]
}

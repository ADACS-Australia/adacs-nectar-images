---
- name: Provision the image
  hosts: default
  gather_facts: true
  become: false

  tasks:
    - name: install autofs
      become: true
      yum:
        name: autofs

    - name: autofs configuration 1
      become: true
      lineinfile:
        path: /etc/auto.master
        line: /mnt/volumes    /etc/auto.volumes   --timeout=300

    - name: autofs configuration 2
      become: true
      lineinfile:
        path: /etc/auto.volumes
        line: software    -fstype=auto,ro   :/dev/disk/by-label/software
        create: true
        mode: "0644"

    - name: enable autofs
      become: true
      systemd:
        name: autofs
        state: started
        enabled: true

    - name: Increase SSH MaxAuthTries to 40 for sshd
      become: true
      lineinfile:
        path: /etc/ssh/sshd_config
        regex: ^(# *)?MaxAuthTries
        line: MaxAuthTries 40

    - name: restart sshd
      become: true
      systemd:
        name: sshd
        state: restarted
        enabled: true

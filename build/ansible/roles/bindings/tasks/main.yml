---

- name: copy search history bindings file
  copy:
    src: "bindings.txt"
    dest: "$HOME/.bindings"
    mode: '666'

- name: search for .profile or .bash_profile
  find:
    paths: "$HOME/"
    patterns: ".*profile"
    file_type: file
    hidden: yes
  register: result

- name: check search result
  fail:
    msg: "Number of matches is not 1 --- RESULT: {{ result }}"
  when: result.matched != 1

- name: source .bindings in .profile
  blockinfile:
    path: "{{ item }}"
    block: source $HOME/.bindings
    marker: "{mark}"
    marker_begin: "# >>> set bindings for ipython style forward/reverse history search"
    marker_end: "# <<<"
  with_items: "{{ result.files[0].path }}"

---
# Note: using 'dnf' instead of 'yum'

- name: Wait for auto updates to finish
  become: true
  shell:
    cmd: time (while ps -opid= -C dnf-automatic > /dev/null; do sleep 1; done);

- name: Upgrade all packages
  become: true
  dnf:
    name: "*"
    state: latest
    update_cache: true

- name: yum install packages
  become: true
  dnf:
    name: "{{ yum_packages }}"
